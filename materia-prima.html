<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juan Tribaldos</title>
    
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        /* Estilos para la nueva rejilla (Grid) */
        #arena-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 columnas */
            gap: 20px 30px; /* Espacio vertical y horizontal */
            padding: 80px 20px; /* Espacio superior para no chocar con el nav */
            list-style: none;
            margin: 0 auto;
            max-width: 1200px;
        }

        .work-item {
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .work-item img {
            width: 100%;
            height: auto;
            display: block;
            margin-bottom: 2px;
        }

        /* Estilo del pie de foto (Título + Size) */
        .caption {
            font-family: inherit; /* O la que uses en tu style.css */
            font-size: 11px;
            letter-spacing: 0.5px;
            
        }

        .file-size {
            color: #000000;
            margin-top: 4px;
            font-size: 10px;
        }

        /* Responsive para móviles */
        @media (max-width: 768px) {
            #arena-container {
                grid-template-columns: 1fr;
                padding-top: 120px;
            }
        }

        /* Visor Fullscreen */
        #fullscreen-viewer {
            display:none; 
            position: fixed; 
            top:0; left:0; 
            width:100%; height:100%; 
            background:rgba(255,255,255,0.98); 
            z-index:9999; 
            cursor:pointer; 
            align-items:center; 
            justify-content:center;
        }


    </style>
</head>
<body>

    <script src="nav.js"></script>

    <main>
        <ul id="arena-container"></ul>
        <div id="fullscreen-viewer"></div>
    </main>

    <script>
        /* --- LÓGICA DE NAVEGACIÓN --- */
        document.querySelectorAll('.select-trigger').forEach(trigger => {
            trigger.addEventListener('click', (e) => {
                const options = trigger.nextElementSibling;
                document.querySelectorAll('.select-options').forEach(opt => {
                    if (opt !== options) opt.classList.remove('open');
                });
                options.classList.toggle('open');
                e.stopPropagation();
            });
        });

        document.querySelectorAll('.select-options li').forEach(option => {
            option.addEventListener('click', (e) => {
                const val = option.getAttribute('data-value');
                if (val) window.location.href = val;
                e.stopPropagation();
            });
        });

        window.addEventListener('click', () => {
            document.querySelectorAll('.select-options').forEach(opt => opt.classList.remove('open'));
        });

/* --- INTEGRACIÓN API ARE.NA ACTUALIZADA --- */
$(function() {
    const CHANNEL_SLUG = 'exploraciones_materia-prima'; 
    const API_BASE = 'https://api.are.na/v2';

    async function fetchArenaBlocks() {
        try {
            const response = await fetch(`${API_BASE}/channels/${CHANNEL_SLUG}/contents?per=100&direction=desc`);
            const data = await response.json();
            return data.contents.filter(block => block.class === 'Image');
        } catch (error) {
            console.error("Error cargando Are.na:", error);
            return [];
        }
    }

    // Función inspirada en Gregory Cotton para obtener el tamaño real del archivo
    async function getRealFileSize(imageUrl, element) {
        try {
            const response = await fetch(imageUrl);
            if (!response.ok) return;
            const blob = await response.blob();
            // Formateamos con puntos de miles y actualizamos el texto
            element.innerText = blob.size.toLocaleString() + " bytes";
        } catch (error) {
            console.error("No se pudo obtener el tamaño para:", imageUrl);
        }
    }

    async function init() {
        const blocks = await fetchArenaBlocks();
        const $container = $('#arena-container');

        blocks.forEach((block) => {
            const imageUrl = block.image.display.url;
            const title = block.title || "Untitled";
            
            // Creamos el ID único para cada contador de bytes
            const sizeId = `size-${block.id}`;
            
            const html = `
                <li class="work-item">
                    <img src="${imageUrl}" alt="${title}" />
                    <div class="caption">
                        <div class="image-title">${title}</div>
                        <div class="file-size" id="${sizeId}">Loading bytes...</div>
                    </div>
                </li>`;
            
            const $newItem = $(html);
            $container.append($newItem);

            // Ejecutamos el cálculo del tamaño después de añadir el elemento al DOM
            const sizeElement = document.getElementById(sizeId);
            getRealFileSize(imageUrl, sizeElement);
            
            // Click para Fullscreen
            $newItem.on('click', function() {
                $('#fullscreen-viewer').html(`<img src="${imageUrl}" style="max-width:90%; max-height:90%;">`).css('display', 'flex');
            });
        });
    }

    $('#fullscreen-viewer').on('click', function() { $(this).hide(); });

    init();
});
    </script>
</body>
</html>